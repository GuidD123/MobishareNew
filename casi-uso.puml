@startuml MobishareUseCases
left to right direction
skinparam packageStyle rectangle
skinparam actorStyle awesome

actor "Utente" as UT
actor "Gestore" as GE

rectangle "Piattaforma Mobishare" {

  ' ==========================
  ' UC1 - Gestione autenticazione
  ' ==========================
  usecase "UC1\nGestione autenticazione" as UC1

  usecase "Registrazione" as UC1_Reg
  usecase "Login" as UC1_Login
  usecase "Cambio password" as UC1_CambiaPwd
  usecase "Reset password" as UC1_ResetPwd

  UC1 ..> UC1_Reg       : <<include>>
  UC1 ..> UC1_Login     : <<include>>
  UC1 ..> UC1_CambiaPwd : <<include>>
  UC1 ..> UC1_ResetPwd  : <<include>>

  UT -- UC1

  ' ==========================
  ' UC2 - Gestione utenti (Gestore)
  ' ==========================
  usecase "UC2\nGestione utenti" as UC2

  usecase "Visualizzare lista utenti" as UC2_Lista
  usecase "Visualizzare utenti sospesi" as UC2_Sospesi
  usecase "Visualizzare dettaglio utente" as UC2_Dettaglio
  usecase "Riattivare utente" as UC2_Riattiva

  UC2 ..> UC2_Lista      : <<include>>
  UC2 ..> UC2_Sospesi    : <<include>>
  UC2 ..> UC2_Dettaglio  : <<include>>
  UC2 ..> UC2_Riattiva   : <<include>>

  GE -- UC2

  ' ==========================
  ' UC3 - Consultazione mezzi
  ' ==========================
  usecase "UC3\nConsultazione mezzi" as UC3

  usecase "Elenco mezzi" as UC3_Elenco
  usecase "Mezzi disponibili" as UC3_Disp
  usecase "Mezzi non prelevabili\n(solo Gestore)" as UC3_NonPrev
  usecase "Ricerca per matricola" as UC3_Ricerca
  usecase "Dettaglio mezzo" as UC3_Dett
  usecase "Mezzi in un parcheggio" as UC3_MezziParcheggio
  usecase "Statistiche mezzi\n(solo Gestore)" as UC3_Stats

  UC3 ..> UC3_Elenco          : <<include>>
  UC3 ..> UC3_Disp            : <<include>>
  UC3 ..> UC3_NonPrev         : <<include>>
  UC3 ..> UC3_Ricerca         : <<include>>
  UC3 ..> UC3_Dett            : <<include>>
  UC3 ..> UC3_MezziParcheggio : <<include>>
  UC3 ..> UC3_Stats           : <<include>>

  UT -- UC3
  GE -- UC3

  ' ==========================
  ' UC4 - Amministrazione mezzi (Gestore)
  ' ==========================
  usecase "UC4\nAmministrazione mezzi" as UC4

  usecase "Creazione nuovo mezzo" as UC4_Crea
  usecase "Modifica stato mezzo" as UC4_Stato
  usecase "Ricarica mezzo" as UC4_Ricarica
  usecase "Eliminazione mezzo" as UC4_Elimina
  usecase "Segnalazione guasto" as UC4_Guasto
  usecase "Aggiornamento batteria\n(MQTT)" as UC4_Batteria

  UC4 ..> UC4_Crea      : <<include>>
  UC4 ..> UC4_Stato     : <<include>>
  UC4 ..> UC4_Ricarica  : <<include>>
  UC4 ..> UC4_Elimina   : <<include>>
  UC4 ..> UC4_Guasto    : <<include>>
  UC4 ..> UC4_Batteria  : <<include>>

  GE -- UC4

  ' ==========================
  ' UC5 - Consultazione parcheggi
  ' ==========================
  usecase "UC5\nConsultazione parcheggi" as UC5

  usecase "Lista parcheggi" as UC5_Lista
  usecase "Dettaglio parcheggio" as UC5_Dett
  usecase "DisponibilitÃ  posti" as UC5_Disp

  UC5 ..> UC5_Lista : <<include>>
  UC5 ..> UC5_Dett  : <<include>>
  UC5 ..> UC5_Disp  : <<include>>

  UT -- UC5
  GE -- UC5

  ' ==========================
  ' UC6 - Amministrazione parcheggi (Gestore)
  ' ==========================
  usecase "UC6\nAmministrazione parcheggi" as UC6

  usecase "Creazione nuovo parcheggio" as UC6_Crea
  usecase "Attivazione/Disattivazione" as UC6_Stato
  usecase "Eliminazione parcheggio" as UC6_Elimina

  UC6 ..> UC6_Crea    : <<include>>
  UC6 ..> UC6_Stato   : <<include>>
  UC6 ..> UC6_Elimina : <<include>>

  GE -- UC6

  ' ==========================
  ' UC7 - Consultazione corse
  ' ==========================
  usecase "UC7\nConsultazione corse" as UC7

  usecase "Visualizzazione corsa attiva" as UC7_Attiva
  usecase "Lista corse utente" as UC7_Lista
  usecase "Dettaglio corsa" as UC7_Dett
  usecase "Storico corse" as UC7_Storico
  usecase "Statistiche corse\n(solo Gestore)" as UC7_Stats

  UC7 ..> UC7_Attiva  : <<include>>
  UC7 ..> UC7_Lista   : <<include>>
  UC7 ..> UC7_Dett    : <<include>>
  UC7 ..> UC7_Storico : <<include>>
  UC7 ..> UC7_Stats   : <<include>>

  UT -- UC7
  GE -- UC7

  ' ==========================
  ' UC8 - Gestione corsa (Utente)
  ' ==========================
  usecase "UC8\nGestione corsa" as UC8

  usecase "Avvio corsa" as UC8_Avvia
  usecase "Termina corsa" as UC8_Termina

  UC8 ..> UC8_Avvia   : <<include>>
  UC8 ..> UC8_Termina : <<include>>

  UT -- UC8

  ' ==========================
  ' UC9 - Gestione ricariche (Utente)
  ' ==========================
  usecase "UC9\nGestione ricariche" as UC9

  usecase "Effettuare ricarica" as UC9_Esegui
  usecase "Visualizzare storico ricariche" as UC9_Storico
  usecase "Visualizzare saldo personale" as UC9_Saldo
  usecase "Conferma ricarica\n(webhook)" as UC9_Webhook

  UC9 ..> UC9_Esegui   : <<include>>
  UC9 ..> UC9_Storico  : <<include>>
  UC9 ..> UC9_Saldo    : <<include>>
  UC9 ..> UC9_Webhook  : <<include>>

  UT -- UC9

  ' ==========================
  ' UC10 - Consultazione transazioni
  ' ==========================
  usecase "UC10\nConsultazione transazioni" as UC10

  usecase "Consultare transazioni utente" as UC10_ByUtente
  usecase "Consultare proprie transazioni" as UC10_Mie
  usecase "Aggiornare stato transazione\n(solo Gestore)" as UC10_Aggiorna

  UC10 ..> UC10_ByUtente : <<include>>
  UC10 ..> UC10_Mie      : <<include>>
  UC10 ..> UC10_Aggiorna : <<include>>

  UT -- UC10
  GE -- UC10

  ' ==========================
  ' UC11 - Gestione feedback
  ' ==========================
  usecase "UC11\nGestione feedback" as UC11

  usecase "Inviare feedback" as UC11_Invia
  usecase "Visualizzare feedback utente" as UC11_Miei
  usecase "Visualizzare feedback recenti" as UC11_Recenti
  usecase "Visualizzare feedback negativi" as UC11_Negativi
  usecase "Statistiche feedback" as UC11_Stats

  UC11 ..> UC11_Invia     : <<include>>
  UC11 ..> UC11_Miei      : <<include>>
  UC11 ..> UC11_Recenti   : <<include>>
  UC11 ..> UC11_Negativi  : <<include>>
  UC11 ..> UC11_Stats     : <<include>>

  UT -- UC11
  GE -- UC11

  ' ==========================
  ' UC12 - Dashboard Gestore
  ' ==========================
  usecase "UC12\nDashboard gestore" as UC12

  usecase "Panoramica mezzi" as UC12_Mezzi
  usecase "Panoramica utenti" as UC12_Utenti
  usecase "Panoramica corse" as UC12_Corse
  usecase "Panoramica credito totale" as UC12_Credito
  usecase "Notifiche in tempo reale" as UC12_Notifiche

  UC12 ..> UC12_Mezzi     : <<include>>
  UC12 ..> UC12_Utenti    : <<include>>
  UC12 ..> UC12_Corse     : <<include>>
  UC12 ..> UC12_Credito   : <<include>>
  UC12 ..> UC12_Notifiche : <<include>>

  GE -- UC12
}

' ==============================================
' PROCESSI AUTOMATICI (NON CASI D'USO)
' ==============================================
package "Processi automatici\n(non casi d'uso)" {
  component "RideMonitoringService" <<service>> as S_Ride
  component "MqttTelemetryListenerService" <<service>> as S_Mqtt
  component "SignalR Hub" <<system>> as S_SignalR
}

note right of S_Ride
  Monitoraggio corse attive
  e sospensione automatica utenti
end note

note right of S_Mqtt
  Aggiornamento telemetria batteria
  via MQTT (emulatore IoT)
end note

note right of S_SignalR
  Notifiche real-time
  a utenti e gestori
end note

@enduml
